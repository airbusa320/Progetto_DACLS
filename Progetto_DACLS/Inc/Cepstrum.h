/****************************************************************
 *  															*
 *   Cepstrum.h												*
 * 																*
 *    Created on: 24 mar 2018									*
 *        Author: Riccardo, Stefano								*
 *	 															*
 ****************************************************************/

#ifndef CEPSTRUM_H_
#define CEPSTRUM_H_



#include "stm32f4xx_hal.h"
#include "main.h"

#define ARM_MATH_CM4
#include "arm_math.h"

#define FSTART 	0			// Parametri per il calcolo dei
#define FSTOP 	16000		// coefficienti MFCC
#define FS 		32000		//
#define NFFT 	1024		//
#define NFILT 	26			//
#define NMFCC 	20			//



float32_t pari[NFFT], dispari[NFFT];
float32_t DCTParam[NFILT*NFILT];

/* Struttura per l'handle dei filtri mel,
 * fstart: bin di inizio del filtro
 * len: lunghezza in bin del filtro
 * fdata: puntatore al primo bin del filtro memorizzato
 */
typedef struct {
	uint16_t fstart;
	uint16_t len;
	float32_t * fdata;
}ftri_handle;

ftri_handle hfilt[NFILT];

arm_fir_instance_f32 prem;
float32_t prestato[2049];

void tFiltInit();

void powerSpectrum(float32_t * pIn, uint16_t len, float32_t * pOut);
void estrazione(float32_t * pIn, float32_t * pOut, uint16_t inLen, uint16_t nFilt, ftri_handle * filtri);
void estrazione2(float32_t * pIn, float32_t * pOut, uint16_t inLen, uint16_t nFilt, uint16_t nMFFC, ftri_handle * filtri);
void parametriDCT();



float32_t deviazione_standard[80]={
		49.3226280212402,
		6.83182048797607,
		9.89175224304199,
		7.00441551208496,
		5.18394708633422,
		3.1838309764862,
		3.46642518043518,
		2.92010617256164,
		2.9939534664154,
		2.61987733840942,
		2.39356112480163,
		2.08268189430236,
		2.04438114166259,
		1.76702404022216,
		1.6404732465744,
		1.56908822059631,
		1.49578464031219,
		1.37184953689575,
		1.3638607263565,
		1.23874700069427,
		49.7791519165039,
		7.0341567993164,
		9.65910530090332,
		7.67660951614379,
		4.9692678451538,
		3.21884083747863,
		3.49141287803649,
		3.01789140701293,
		2.59471583366394,
		2.60164737701416,
		2.38667297363281,
		2.04285144805908,
		2.14020538330078,
		1.69670331478118,
		1.68133974075317,
		1.58529937267303,
		1.4791088104248,
		1.39382219314575,
		1.27324891090393,
		1.26761949062347,
		49.9512710571289,
		6.61558723449707,
		9.14210700988769,
		7.38848209381103,
		4.88466072082519,
		3.63300466537475,
		4.21949958801269,
		3.08091592788696,
		2.87857031822204,
		2.92153763771057,
		2.33542609214782,
		2.0235595703125,
		2.17005038261413,
		1.74694085121154,
		1.68260979652404,
		1.63495337963104,
		1.56606078147888,
		1.42588806152343,
		1.31392669677734,
		1.23244881629943,
		48.601333618164,
		6.58216142654418,
		9.67076873779296,
		7.09380769729614,
		4.82317161560058,
		3.05360865592956,
		3.35577130317687,
		3.16987466812133,
		3.01435756683349,
		2.75272107124328,
		2.63300418853759,
		2.130291223526,
		2.0780131816864,
		1.79552555084228,
		1.97997236251831,
		1.7535001039505,
		1.62145006656646,
		1.43714308738708,
		1.37448525428771,
		1.32402741909027
};

float32_t media[80] = {
		-362.732879638671,
		0.279490172863007,
		-9.28191947937011,
		-2.04671502113342,
		0.561201572418212,
		-2.46985244750976,
		8.97079277038574,
		-2.36531138420104,
		3.16950154304504,
		2.31967830657958,
		1.42557144165039,
		0.859925806522369,
		0.203839614987373,
		0.479691714048386,
		1.19446158409118,
		-0.0366119518876076,
		0.345987379550934,
		0.0442263595759869,
		0.33283931016922,
		0.546532928943634,
		-360.415008544921,
		0.883649289608001,
		-10.1742095947265,
		-2.44215965270996,
		3.05144762992858,
		-2.9692690372467,
		7.39110136032104,
		-1.06510186195373,
		2.7575876712799,
		2.93557333946228,
		1.0871992111206,
		-0.0331040360033512,
		1.22133314609527,
		0.403814762830734,
		1.18514049053192,
		-0.0345370732247829,
		0.0365258529782295,
		0.49114653468132,
		0.203312650322914,
		0.293592572212219,
		-340.527954101562,
		0.326146513223648,
		-9.07288265228271,
		0.0912772938609123,
		3.16062498092651,
		-0.591340720653533,
		9.9211778640747,
		-0.970264196395874,
		2.99354362487792,
		1.87333512306213,
		0.0247892290353775,
		0.12721885740757,
		0.855376839637756,
		0.665803134441375,
		1.3095086812973,
		-0.185036316514015,
		0.302372843027115,
		0.353705614805222,
		0.23917019367218,
		0.333839297294617,
		-345.443328857421,
		-4.51070117950439,
		-14.5715856552124,
		-5.69514799118041,
		-2.74677324295043,
		-6.48737812042236,
		4.76302480697631,
		-4.56041097640991,
		1.58178865909576,
		2.15926313400268,
		0.665197789669036,
		-0.0890393182635307,
		-0.139029055833817,
		-0.178543090820312,
		1.06286346912384,
		-0.128794848918915,
		0.199574559926987,
		0.124268710613251,
		0.120543129742146,
		0.390305429697037
};

#endif /* CEPSTRUM_H_ */
